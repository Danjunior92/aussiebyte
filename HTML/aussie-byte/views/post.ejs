<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title><%= post.title %></title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>
  <!-- Header and back link to the homepage -->
  <header>
    <%- include('partials/header.ejs') %>
  </header>

  <main>
    <!-- The `post` object is passed from the server. Use `post.title` and `post.content` -->
    <article class="full-post">
      <h2><%= post.title %></h2>
      <p><%= post.content %></p>

      <% if(user) { %>
      <!-- If user is logged in, show edit and delete options -->
      <!-- Edit and delete controls for this post -->
        <a href="/post/edit/<%= post.id %>">Edit Post</a>

        <hr>
        <!-- Simple delete form that POSTs to /post/delete/:id -->
        <form action="/post/delete/<%= post.id %>" method="POST" class="delete-form">
          <button type="submit">Delete Post</button>
        </form>
      <% } %>
    </article>

    <!-- Comments section -->
    <section class="comment-section">
      <h3>Comments</h3>

      <!-- The server passes `comments` (array) to this template. If there are comments,
           iterate and render them; otherwise show a placeholder message. -->
      <% if (Array.isArray(comments) && comments.length > 0) { %>
        <% comments.forEach(c => { %>
          <div class="comment">
            <strong><%= c.author %></strong> rated it <%= c.rating %> stars
            <time datetime="<%= c.created_at %>">
              <%= new Date(c.created_at).toLocaleString() %>
            </time>
            <p><%= c.content %></p>
          </div>
        <% }) %>
      <% } else { %>
        <p>No comments yet. Be the first to comment!</p>
      <% } %>
    </section>

    <!-- Comment form: fields map to req.body.author, req.body.content, req.body.rating -->
    <form action="/post/<%= post.id %>/comment" method="POST" class="comment-form">
      <h4>Leave a Comment</h4>

      <div>
        <label for="author">Your Name:</label>
        <input type="text" id="author" name="author" required>
      </div>

      <div>
        <label for="rating">Rating:</label>
        <select id="rating" name="rating" required>
          <option value="5">5 Stars</option>
          <option value="4">4 Stars</option>
          <option value="3">3 Stars</option>
          <option value="2">2 Stars</option>
          <option value="1">1 Star</option>
        </select>
      </div>

      <div>
        <label for="content">Comment:</label>
        <textarea id="content" name="content" rows="4" required></textarea>
      </div>

      <button type="submit">Submit Comment</button>
    </form>

  </main>

  <footer>
    <%- include('partials/footer.ejs') %>
  </footer>
</body>

</html>